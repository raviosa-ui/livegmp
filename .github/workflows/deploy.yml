name: Build and Deploy to DreamHost (FTPS)

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: Build site (skip if HTML only)
      run: |
        if [ -f package.json ]; then
          npm ci
          npm run build || echo "No build step"
          npm run export || echo "No export step"
        fi

    - name: Deploy via FTPS
      uses: SamKirkland/ftp-deploy-action@v4
      with:
        server: ${{ secrets.DH_HOST }}
        username: ${{ secrets.DH_USER }}
        password: ${{ secrets.DH_PASS }}
        port: ${{ secrets.DH_PORT }}
        protocol: ftps
        local-dir: .
        server-dir: /home/${{ secrets.DH_USER }}/livegmp.in
