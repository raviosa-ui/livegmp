name: Build and Deploy to DreamHost (FTPS)

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 18

    - name: Build site (if applicable)
      run: |
        if [ -f package.json ]; then
          npm ci
          npm run build --if-present
          npm run export --if-present
        fi

    - name: Deploy via FTPS
      uses: SamKirkland/ftp-deploy-action@v4
      with:
        server: ${{ secrets.DH_HOST }}
        username: ${{ secrets.DH_USER }}
        password: ${{ secrets.DH_PASS }}
        port: 21  # DreamHost uses explicit FTPS on port 21
        protocol: ftps
        local-dir: ./  # ⚠️ Consider ./out/, ./dist/, or ./public/ if built
        server-dir: /home/${{ secrets.DH_USER }}/livegmp.in/
        # Optional: exclude files
        exclude: |
          .git*
          node_modules/
          *.md
          .ftp-deploy-sync-config.json
