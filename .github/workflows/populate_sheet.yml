name: Daily Sheet Update (TEST MODE)

on:
  schedule:
    - cron: '0 10 * * *'   # adjust as needed
  workflow_dispatch:

jobs:
  update-sheet:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Ensure package.json and install runtime deps
        run: |
          if [ ! -f package.json ]; then npm init -y; fi
          npm install cheerio googleapis

      - name: Run Node Script (PARSING TEST - no write)
        env:
          # Put the full JSON here (raw JSON, not base64)
          GOOGLE_APPLICATION_CREDENTIALS_RAW: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_RAW }}
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
          # optional: GOOGLE_API_KEY if you want for reads
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          # newline-separated list of source URLs; primary first
          GMP_SOURCE_URLS: ${{ secrets.GMP_SOURCE_URLS }}
          DEFAULT_TYPE: ${{ secrets.DEFAULT_TYPE }}
          FILL_TYPE_FROM_NSE: ${{ secrets.FILL_TYPE_FROM_NSE }}
          # TEST_MODE true -> parsing only, no write
          TEST_MODE: "false"
        run: |
          node scripts/populate_sheet.js
