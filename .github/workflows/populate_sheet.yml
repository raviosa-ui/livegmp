# Replace the entire content of your YAML file with this (adjusting names if needed)

name: Daily Sheet Update

on:
  schedule:
    # Runs at 10:00 AM UTC every day
    - cron: '0 10 * * *'
  workflow_dispatch:
    # Allows manual running from the GitHub Actions tab

jobs:
  update-sheet:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Use a recent stable Node.js version
          
      - name: Install Dependencies
        run: npm install
        
      - name: Run Node Script with RAW Credentials
        run: node scripts/populate_sheet.js
        env:
          # âœ… NEW: Use the unencoded JSON secret for the Service Account authentication
          GOOGLE_APPLICATION_CREDENTIALS_RAW: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_RAW }}
          
          # Keep your other essential variables
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }} 
          # ... include any other non-Google secrets (e.g., DM_HOST, etc.) here if needed
